<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Nurse Registration</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
<div class="container mt-5">

    <h3 class="mb-4" th:text="${nurse.id==null ? 'Add Nurse' : 'Edit Nurse'}"></h3>

    <form id="nurseForm" action="/nurses/save" method="post">
        <input type="hidden" name="id" th:value="${nurse.id}">

        <div class="mb-3">
            <label class="form-label">Name</label>
            <input name="name" class="form-control" th:value="${nurse.name}" placeholder="Enter full name" required>
        </div>

        <div class="mb-3">
            <label class="form-label">Qualification</label>
            <input name="qualification" class="form-control" th:value="${nurse.qualification}" placeholder="e.g. BSc Nursing" required>
        </div>

        <div class="mb-3">
            <label class="form-label">Gender</label>
            <select name="gender" class="form-select" required>
                <option value="">Select Gender</option>
                <option th:selected="${nurse.gender=='Male'}" value="Male">Male</option>
                <option th:selected="${nurse.gender=='Female'}" value="Female">Female</option>
            </select>
        </div>

        <div class="mb-3">
            <label class="form-label">Shift</label>
            <select name="shift" class="form-select" required>
                <option value="">Select Shift</option>
                <option th:selected="${nurse.shift=='DAY'}" value="DAY">DAY</option>
                <option th:selected="${nurse.shift=='NIGHT'}" value="NIGHT">NIGHT</option>
            </select>
        </div>

        <div class="mb-3">
            <label class="form-label">Status</label>
            <select name="status" class="form-select" id="statusSelect" required>
                <option th:selected="${nurse.status=='WORKING'}" value="WORKING">WORKING</option>
                <option th:selected="${nurse.status=='NOT_WORKING'}" value="NOT_WORKING">NOT WORKING</option>
            </select>
        </div>

        <div class="mb-3" id="timeBox" style="display:none;">
            <p>Entry Time: <span id="entryTime" th:text="${nurse.entryTime}">-</span></p>
            <p>Exit Time: <span id="exitTime" th:text="${nurse.exitTime}">-</span></p>
        </div>

        <button type="submit" class="btn btn-primary">Save</button>
        <a href="/nurses" class="btn btn-secondary ms-2">Back to List</a>
    </form>

</div>

<script>
    const statusSelect = document.getElementById('statusSelect');
    const timeBox = document.getElementById('timeBox');
    const entryTimeSpan = document.getElementById('entryTime');
    const exitTimeSpan = document.getElementById('exitTime');

    // Show entry/exit times only if nurse exists
    if (entryTimeSpan.innerText.trim() || exitTimeSpan.innerText.trim()) {
        timeBox.style.display = 'block';
    }

    // Show alert if status changes
    document.getElementById('nurseForm').addEventListener('submit', function(e) {
        const status = statusSelect.value;
        if (!status) {
            e.preventDefault();
            Swal.fire({
                icon: 'error',
                title: 'Oops...',
                text: 'Please select a valid status!'
            });
        } else {
            let msg = status === 'WORKING' 
                ? 'Nurse will start working now. Entry time will be recorded.'
                : 'Nurse has ended shift. Exit time will be recorded.';
            Swal.fire({
                icon: 'success',
                title: 'Info',
                text: msg,
                timer: 1500,
                showConfirmButton: false
            });
        }
    });
</script>
</body>
</html>

